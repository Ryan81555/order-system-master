<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í¬ë¦¬ìŠ¤ì›”ë“œ ë¹Œë¦¬ì§€ ë©”ë‰´ ì£¼ë¬¸ì‹œìŠ¤í…œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
  <script>tailwind.config={theme:{extend:{colors:{primary:'#B026FF',secondary:'#6A0DAD'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #1A1A1A;
      color: #FFFFFF;
      min-height: 100vh;
    }
    .neon-text {
      text-shadow: 0 0 5px #B026FF, 0 0 10px #B026FF, 0 0 15px #B026FF;
    }
    .neon-border {
      box-shadow: 0 0 5px #B026FF, 0 0 10px #B026FF;
    }
    .neon-button {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    .neon-button:before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      z-index: -1;
      background: #B026FF;
      filter: blur(8px);
      opacity: 0.7;
      border-radius: 10px;
    }
    .neon-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px #B026FF;
    }
    .neon-input {
      border: 1px solid #B026FF;
      box-shadow: 0 0 5px #B026FF;
    }
    .neon-input:focus {
      box-shadow: 0 0 10px #B026FF, 0 0 15px #B026FF;
    }
    .cart-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: #B026FF;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      box-shadow: 0 0 5px #B026FF;
    }
  </style>
</head>
<body class="relative">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="fixed top-0 left-0 w-full bg-black bg-opacity-90 z-50 border-b border-primary shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-bold neon-text text-primary font-['Pacifico']">í¬ë¦¬ìŠ¤ì›”ë“œ ë¹Œë¦¬ì§€ ë‚­ë§Œí¬ì°¨</h1>
            <div class="relative cursor-pointer" id="cartIcon">
                <div class="w-10 h-10 flex items-center justify-center">
                    <i class="ri-shopping-cart-2-line ri-lg text-white"></i>
                </div>
                <span class="cart-badge" id="cartBadge">0</span>
            </div>
        </div>
    </nav>
    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="container mx-auto px-4 pt-20 pb-24 max-w-md">
        <!-- ì•ˆë‚´ë¬¸êµ¬ ë° ì…ë ¥í¼ -->
        <section class="py-6 text-center">
            <div class="bg-black bg-opacity-60 rounded-xl p-4 mb-4 neon-border">
                <div class="text-primary font-bold mb-2">í…Œì´ë¸” ë²ˆí˜¸ ë˜ëŠ” ê°ì‹¤ ë™í˜¸ìˆ˜ë¥¼ ì ì–´ì£¼ì„¸ìš”.</div>
                <div class="text-sm text-green-400 mb-2">ë‚­ë§Œí¬ì°¨ì— ê³„ì‹œë‹¤ë©´ <b>í…Œì´ë¸” ë²ˆí˜¸</b>ë¥¼,<br>í¬ë¦¬ìŠ¤ì›”ë“œ ë¹Œë¦¬ì§€ ê°ì‹¤ì—ì„œ í¸ì•ˆí•¨ì„ ë§Œë½ ì¤‘ì´ì‹œë¼ë©´ <b>ë™/í˜¸ìˆ˜</b>ë¥¼ ì ì–´ì£¼ì„¸ìš”.</div>
                <div class="flex flex-col gap-2 items-center">
                    <label class="flex items-center gap-2">í…Œì´ë¸” ë²ˆí˜¸:
                        <input type="number" id="tableNum" min="1" max="20" required class="neon-input rounded-md px-2 py-1 w-20 text-center font-bold bg-gray-900 text-white" />
                    </label>
                    <label class="flex items-center gap-2">ê°ì‹¤ ë™í˜¸ìˆ˜:
                        <input type="text" id="roomNum" maxlength="20" placeholder="ì˜ˆ: Cë™ 101í˜¸" class="neon-input rounded-md px-2 py-1 w-32 text-center font-bold bg-gray-900 text-white" />
                    </label>
                    <label class="flex items-center gap-2">ì „í™”ë²ˆí˜¸:
                        <input type="tel" id="phoneNum" maxlength="20" placeholder="ì˜ˆ: 010-1234-5678" class="neon-input rounded-md px-2 py-1 w-36 text-center font-bold bg-gray-900 text-white" />
                    </label>
                </div>
            </div>
        </section>
        <section class="mb-8">
            <div class="grid gap-4" id="pochaMenuList"></div>
            <div class="grid gap-4" id="commonMenuList"></div>
        </section>
        <!-- ì£¼ë¬¸ ë¯¸ë¦¬ë³´ê¸° -->
        <section class="mb-8">
            <div id="orderPreview" class="bg-gray-900 rounded-xl p-4 neon-border mb-4">
                <div class="font-bold text-primary mb-2">ì£¼ë¬¸ ë¯¸ë¦¬ë³´ê¸°</div>
                <div id="previewItems" class="text-white mb-2"></div>
                <div id="previewTotal" class="font-bold text-green-400"></div>
            </div>
            <button id="orderBtn" class="w-full py-3 bg-primary text-white rounded-button font-medium neon-button text-lg">ì£¼ë¬¸í•˜ê¸°</button>
            <div id="result" class="mt-4 text-center text-primary font-bold min-h-[24px]"></div>
        </section>
        <!-- ì•ˆë‚´/ê³„ì¢Œ ì •ë³´ -->
        <section class="mb-8">
            <div class="bg-black bg-opacity-60 rounded-xl p-4 neon-border text-center">
                <div class="text-red-400 font-bold mb-2">ê²°ì œ ë°©ì‹ì€ ê³„ì¢Œì´ì²´ë§Œ ì§€ì›í•©ë‹ˆë‹¤.<br>ê°ì‚¬í•©ë‹ˆë‹¤.</div>
                <div class="text-white font-bold">ì…ê¸ˆê³„ì¢Œ: ì‚°ë¦¼ì¡°í•©ì¤‘ì•™íšŒ 164-11-0000788 <br>(ì˜ˆê¸ˆì£¼: ì´ë™í›ˆ)</div>
            </div>
            <button id="adminLoginBtn" class="mt-6 w-full py-2 bg-gray-800 text-white rounded-button neon-button">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
        </section>
        <!-- ì¹´í˜ í”„ë¡œëª¨ì…˜ ì•ˆë‚´ -->
        <section class="mb-8">
            <div class="bg-orange-50 bg-opacity-90 border-2 border-orange-300 rounded-xl p-6 neon-border text-center text-orange-900 shadow-lg">
                <div class="text-xl font-bold neon-text text-orange-600 mb-2">
                    ğŸ‰ í¬ë¦¬ìŠ¤ì›”ë“œ ë¹Œë¦¬ì§€ ê³ ê° ì „ìš© <br>ê°€í‰ ì¹´í˜ íŠ¹ë³„ í• ì¸!
                </div>
                <div class="mb-2">
                    ì €í¬ í¬ë¦¬ìŠ¤ì›”ë“œ ë¹Œë¦¬ì§€ì— ì˜¤ì‹  ë¶„ë“¤ê»˜ë§Œ ë“œë¦¬ëŠ” í˜œíƒ!<br>
                    <b>ì¹´í˜ "ê°€í‰ ë ˆì´í¬ì• ë¹„ë‰´"</b>ì—ì„œ <span class="text-orange-600 font-semibold"><br>ìŒë£Œ ì „í’ˆëª© 10% í• ì¸</span>ì„ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                    <span class="text-red-600">(â€» ë² ì´ì»¤ë¦¬ë¥˜ëŠ” í• ì¸ ì œì™¸)</span>
                </div>
                <div class="mb-2">
                    <b>í• ì¸ ë°©ë²•:</b> ì²´í¬ì¸ ì‹œ ë°›ìœ¼ì‹  ì•ˆë‚´ ë¬¸ì ë‚´ì—­ì„ <br>ì¹´í˜ ì§ì›ì—ê²Œ ë³´ì—¬ì£¼ì„¸ìš”!
                </div>
                <div class="mb-2">
                    <b>ì¹´í˜ ìœ„ì¹˜:</b> ê°€í‰êµ° í˜¸ë°˜ë¡œ 1526 <br>(í¬ë¦¬ìŠ¤ì›”ë“œ ë¹Œë¦¬ì§€ì—ì„œ ì°¨ëŸ‰ 10ë¶„) ì„¤ì•… IC ë°©í–¥
                </div>
                <div class="mt-4">
                    <a href="https://naver.me/FtTh8MWm" target="_blank" class="text-blue-600 font-bold underline hover:text-primary transition">
                        ğŸ“ ë„¤ì´ë²„ ì§€ë„ì—ì„œ ì¹´í˜ ìœ„ì¹˜ ë³´ê¸°
                    </a>
                </div>
            </div>
        </section>
    </main>
  <script>
    let menuData = [];
    // ì˜ì—…ì‹œê°„: 10ì‹œ ~ 22ì‹œ
    function isBusinessHour() {
      const now = new Date();
      const hour = now.getHours();
      return hour >= 10 && hour < 22;
    }
    // URLì—ì„œ table íŒŒë¼ë¯¸í„° ì½ê¸°
    function getTableFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('table');
    }
    // í˜ì´ì§€ ë¡œë“œ ì‹œ í…Œì´ë¸” ë²ˆí˜¸ ìë™ ì…ë ¥ ë° ì˜ì—…ì‹œê°„ ì²´í¬
    window.onload = function() {
      const tableNum = getTableFromUrl();
      if (tableNum) {
        document.getElementById('tableNum').value = tableNum;
        document.getElementById('tableNum').readOnly = true;
      }
      // ì˜ì—…ì‹œê°„ ì²´í¬
      if (!isBusinessHour()) {
        document.getElementById('orderBtn').disabled = true;
        document.getElementById('orderBtn').style.background = '#ccc';
        document.getElementById('orderBtn').innerText = 'ì˜ì—…ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤';
        document.getElementById('result').innerHTML = '<span style="color:#ff4e50;">ì£¼ë¬¸ ê°€ëŠ¥ ì‹œê°„ì€ ì˜¤ì „ 10ì‹œ ~ ì˜¤í›„ 10ì‹œì…ë‹ˆë‹¤.</span>';
      }
    };
    // ë©”ë‰´ ë¶ˆëŸ¬ì˜¤ê¸°
    function updateOrderPreview() {
      const items = menuData
        .map(menu => ({
          name: menu.name,
          price: menu.price,
          qty: Number(document.getElementById('menu_' + menu.id).value)
        }))
        .filter(item => item.qty > 0);
    
      const previewItemsDiv = document.getElementById('previewItems');
      const previewTotalDiv = document.getElementById('previewTotal');
    
      if (items.length === 0) {
        previewItemsDiv.innerHTML = 'ì„ íƒí•œ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.';
        previewTotalDiv.innerHTML = '';
        return;
      }
    
      previewItemsDiv.innerHTML = items.map(item =>
        `${item.name} Ã— ${item.qty} = ${(item.price * item.qty).toLocaleString()}ì›`
      ).join('<br>');
    
      const total = items.reduce((sum, item) => sum + item.price * item.qty, 0);
      previewTotalDiv.innerHTML = `ì´ ê¸ˆì•¡: <span style="color:#43e97b">${total.toLocaleString()}ì›</span>`;
    }
    
    function addQtyListeners() {
      menuData.forEach(menu => {
        document.getElementById('menu_' + menu.id).addEventListener('input', updateOrderPreview);
      });
    }
    
    // ë©”ë‰´ ë Œë”ë§ ë¶€ë¶„ë§Œ Tailwind/ë„¤ì˜¨ ìŠ¤íƒ€ì¼ë¡œ êµì²´
    fetch('/api/menu')
      .then(res => res.json())
      .then(data => {
        menuData = data;
        const pochaMenuListDiv = document.getElementById('pochaMenuList');
        const commonMenuListDiv = document.getElementById('commonMenuList');
        const onlyPochaMenus = ['í•˜ì´ë„¤ì¼„ ìƒë§¥ì£¼', 'í…Œë¼ ìƒë§¥ì£¼', 'ì•„ë©”ë¦¬ì¹´ë…¸', 'ì–¼ìŒ ë°”í‹€'];
        const pochaMenus = data.filter(menu => onlyPochaMenus.some(name => menu.name.includes(name)));
        const commonMenus = data.filter(menu => !onlyPochaMenus.some(name => menu.name.includes(name)));
        function menuCard(menu) {
          return `<div class="menu-item bg-gray-900 rounded-xl p-4 flex flex-col md:flex-row md:items-center md:justify-between neon-border shadow-lg">
            <div class="flex flex-col md:flex-row md:items-center gap-2">
              <span class="menu-name font-bold text-white text-base md:text-lg">${menu.name}</span>
              <span class="menu-price text-green-400 font-bold text-base md:text-lg ml-0 md:ml-4">${menu.price.toLocaleString()}ì›</span>
            </div>
            <div class="menu-qty flex items-center gap-2 mt-2 md:mt-0">
              <button type="button" class="qty-btn minus-btn px-2 py-1 bg-gray-800 text-white rounded-full neon-button text-lg font-bold" data-id="${menu.id}" ${menu.soldOut ? 'disabled' : ''}>-</button>
              <span id="qty_${menu.id}" class="w-8 text-center font-bold text-white">0</span>
              <button type="button" class="qty-btn plus-btn px-2 py-1 bg-primary text-white rounded-full neon-button text-lg font-bold" data-id="${menu.id}" ${menu.soldOut ? 'disabled' : ''}>+</button>
              <input type="hidden" id="menu_${menu.id}" value="0">
              ${menu.soldOut ? '<span class="ml-2 text-red-400 font-bold">í’ˆì ˆ</span>' : ''}
            </div>
          </div>`;
        }
        pochaMenuListDiv.innerHTML = '<h2 class="text-lg font-bold text-primary mb-2">ë‚­ë§Œí¬ì°¨ ì „ìš© ë©”ë‰´</h2>' +
          pochaMenus.map(menuCard).join('');
        commonMenuListDiv.innerHTML = '<h2 class="text-lg font-bold text-primary mb-2">ë‚­ë§Œí¬ì°¨/ê°ì‹¤ ê³µìš© ë©”ë‰´</h2>' +
          commonMenus.map(menuCard).join('');
        // ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
        menuData.forEach(menu => {
          const minusBtn = document.querySelector(`.minus-btn[data-id='${menu.id}']`);
          const plusBtn = document.querySelector(`.plus-btn[data-id='${menu.id}']`);
          const qtySpan = document.getElementById(`qty_${menu.id}`);
          const hiddenInput = document.getElementById(`menu_${menu.id}`);
          if (!minusBtn || !plusBtn || !qtySpan || !hiddenInput) return;
          minusBtn.addEventListener('click', () => {
            let qty = parseInt(qtySpan.textContent, 10);
            if (qty > 0) {
              qty--;
              qtySpan.textContent = qty;
              hiddenInput.value = qty;
              updateOrderPreview();
            }
          });
          plusBtn.addEventListener('click', () => {
            let qty = parseInt(qtySpan.textContent, 10);
            if (qty < 20) {
              qty++;
              qtySpan.textContent = qty;
              hiddenInput.value = qty;
              updateOrderPreview();
            }
          });
        });
        updateOrderPreview();
      });

      document.getElementById('orderBtn').onclick = () => {
        const table = document.getElementById('tableNum').value.trim();
        const room = document.getElementById('roomNum').value.trim();
        const phone = document.getElementById('phoneNum').value.trim();
        const items = menuData
          .map(menu => ({
            id: menu.id,
            name: menu.name,
            price: menu.price,
            qty: Number(document.getElementById('menu_' + menu.id).value)
          }))
          .filter(item => item.qty > 0);
      
        if ((!table && !room) || items.length === 0) {
          document.getElementById('result').innerText = 'í…Œì´ë¸” ë²ˆí˜¸ ë˜ëŠ” ë™/í˜¸ìˆ˜ ì¤‘ í•˜ë‚˜ì™€ ë©”ë‰´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!';
          return;
        }
        if (!phone) {
          document.getElementById('result').innerText = 'ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!';
          return;
        }
      
        const excessiveQtyItem = items.find(item => item.qty > 20);
        if (excessiveQtyItem) {
          document.getElementById('result').innerHTML = '<span style="color: #ff4e50;">í•œ ë©”ë‰´ë‹¹ ìµœëŒ€ 20ê°œê¹Œì§€ë§Œ ì£¼ë¬¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>';
          return;
        }
      
        const total = items.reduce((sum, item) => sum + item.price * item.qty, 0);

        if (total > 500000) {
            document.getElementById('result').innerHTML = '<span style="color: #ff4e50;">ì´ ì£¼ë¬¸ ê¸ˆì•¡ì´ 50ë§Œì›ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>ëŒ€ëŸ‰ ì£¼ë¬¸ì€ ì „í™”ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</span>';
            return;
        }
      
        fetch('/api/order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ table, room, phone, items, total })
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            document.getElementById('result').innerHTML =
              'ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!<br>' +
              '<span style="color:#ff4e50;font-weight:bold;">ê²°ì œ ë°©ì‹ì€ ê³„ì¢Œì´ì²´ë§Œ ì§€ì›í•©ë‹ˆë‹¤.</span><br>' +
              '<span style="color:#43e97b;font-weight:bold;">ì…ê¸ˆê³„ì¢Œ: ì‚°ë¦¼ì¡°í•©ì¤‘ì•™íšŒ 164-11-0000788 <br>(ì˜ˆê¸ˆì£¼: ì´ë™í›ˆ)</span>';
            // ì…ë ¥ê°’ ì´ˆê¸°í™”
            menuData.forEach(menu => {
              document.getElementById('menu_' + menu.id).value = 0;
            });
            document.getElementById('phoneNum').value = '';
          }
        });
      };

      document.getElementById('adminLoginBtn').onclick = function() {
        const pw = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
        if (pw === '1579') { // ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½
          window.location.href = '/admin';
        } else if (pw !== null) {
          alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
        }
      };

      function openImageModal(src) {
        document.getElementById('imgModalContent').src = src;
        document.getElementById('imgModal').style.display = 'flex';
      }
      function closeImageModal() {
        document.getElementById('imgModal').style.display = 'none';
      }
        </script>
        <div id="imgModal" style="display:none; position:fixed; z-index:99999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); align-items:center; justify-content:center;">
          <span onclick="closeImageModal()" style="position:absolute; top:24px; right:36px; color:#fff; font-size:2.5em; font-weight:700; cursor:pointer; z-index:100001;">&times;</span>
          <img id="imgModalContent" src="" style="max-width:90vw; max-height:80vh; border-radius:14px; box-shadow:0 8px 32px #0008;">
        </div>
</body>
</html>